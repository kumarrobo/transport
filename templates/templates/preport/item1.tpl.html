{$gtotal=0}
<table border="1" width="100%">
    <tr><th>Party Details</th><th>Invoice No</th><th>Date</th><th>Rate</th><th>Quantity</th><th>Free</th><th>Amount</th></tr>
{foreach item=v key=k from=$data}
    <tr><td colspan="7">Item: <b>{$k}</b></td></tr>
    {$total=0} 
    {$totalqty=0} 
    {$totalfree=0} 
    {foreach item=v1 key=k1 from=$v}
    <tr>
        <td>{$v1.party}</td>
        <td>{$v1.bill_no}</td>
        <td>{$v1.bill_date|date_format:$smarty_date}</td>
        <td align="right">{$v1.rate|string_format:"%.2f"}</td>
        <td align="right">{$v1.qty|string_format:"%.2f"}</td>
        <td align="right">{$v1.free|string_format:"%.2f"}</td>
        <td align="right">{$v1.amount|string_format:"%.2f"}</td>
    </tr>
    {$total = $total + $v1.amount}
    {$totalqty = $totalqty + $v1.qty}
    {$totalfree = $totalfree + $v1.free}
    {/foreach}
    <tr>
        <th colspan="4" class="right">Item Total</th>
        <th align="right">{$totalqty|string_format:"%.2f"}</th>
        <th align="right">{$totalfree|string_format:"%.2f"}</th>
        <th align="right">{$total|string_format:"%.2f"}</th>
    </tr>
    {$gtotal = $gtotal + $total}
{/foreach}
    <tr>
        <th colspan="6" class="right">Grand Total</th>
        <th align="right">{$gtotal|string_format:"%.2f"}</th>
    </tr>
</table>